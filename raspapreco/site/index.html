<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/static/css/bootstrap.min.css" rel="stylesheet">
  <link href="/static/css/jquery-ui.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
</head>

<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header header">
        <button aria-controls="navbar" aria-expanded="false" class="navbar-toggle collapsed" data-target="#97bf8afda672ef73a836d55f018b43c868a97bb5"
          data-toggle="collapse" type="button">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <span class="navbar-brand">Raspa Preço</span>
      </div>
      <div class="navbar-collapse collapse" id="97bf8afda672ef73a836d55f018b43c868a97bb5">
        <ul class="nav navbar-nav">
          <li>
            <a href="/" title="Site">Brasilico's Site</a>
          </li>
          <li class="active">
            <a href="/raspapreco/" title="Procedimento">Procedimento</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <input type="hidden" id="token" />
  <div id="login"></div>
  <div class="container" id="content">
    <div class="alert alert-danger alert-dismissible collapse" role="alert" id="jsonerror">
      <button type="button" class="close" onclick="$('#jsonerror').hide()" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <span>
        <p>Erro na conexão ao Servidor!
          <span id="erro"></span>
        </p>
      </span>
    </div>
    <div class="alert alert-success alert-dismissible collapse" role="alert" id="jsonsuccess">
      <button type="button" class="close" onclick="$('#jsonsuccess').hide()" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      <span>
        <p>Sucesso:&nbsp;
          <span id="success"></span>
        </p>
      </span>
    </div>
    <ul id="rowTab" class="nav nav-tabs">
      <li class="active">
        <a data-toggle="tab" href="#sites">Site</a>
      </li>
      <li>
        <a data-toggle="tab" href="#produtos">Produto</a>
      </li>
      <li>
        <a data-toggle="tab" href="#procedimentos">Procedimento</a>
      </li>
    </ul>
    <div class="tab-content">
      <div id="sites" class="tab-pane fade in active">
        <div id="sitedetalhe" class="row">
          <div class="col-xs-8">
            <form id="frmsite">
              <input type="hidden" id="id" name="id">
              <div class="form-group">
                <label for="title">Title:</label>
                <input type="text" class="form-control" id="title" name="title">
              </div>
              <div class="form-group">
                <label for="url">URL:</label>
                <input type="text" class="form-control" id="url" name="url">
              </div>
              <div class="row">
                <div class="col-xs-6">
                  <button class="btn btn-block btn-primary btn-default" id="btnsave">
                    <i class="fa fa-save"></i>&nbsp;Gravar
                  </button>
                </div>
                <div class="col-xs-6">
                  <button class="btn btn-block btn-danger" id="btndelete">
                    <i class="fa fa-trash"></i>&nbsp;Excluir
                  </button>
                </div>
              </div>
            </form>
            <div id="sitetargets" class="row">
              <h4>Configuração do site</h4>
              <div class="form-group">
                <label for="targetkey">Campo:</label>
                <input type="text" id="targetkey">
                <label for="targetvalue">Caminho:</label>
                <input type="text" id="targetvalue">
                <button class="btn btn-success" id="btntarget">
                  <i class="fa fa-plus"></i>&nbsp;Adicionar
                </button>
                <table class="table table-striped table-bordered table-responsive" cellspacing="0" cellpadding="0" id="targets">
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-xs-4" id="sitelist">
            <h3>Sites cadastrados:</h3>
            <div class="form-group">
              <input type="text" class="form-control" id="txtfiltersites">
              <div class="col-xs-6">
                <button class="btn btn-default" id="btnfiltersites">
                  <i class="fa fa-filter"></i>Filtrar
                </button>
              </div>
              <div class="col-xs-6">
                <button class="btn btn-" id="btncleanfiltersites">
                  <i class="fa fa-eraser"></i>Limpar
                </button>
              </div>
            </div>
            <table class="table table-striped table-bordered table-hover table-responsive" cellspacing="0" cellpadding="0" id="sites_table">
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="produtos" class="tab-pane fade">
        <div id="produtodetalhe" class="row">
          <div class="col-xs-8">
            <form id="frmproduto">
              <input type="hidden" id="idproduto" name="idproduto">
              <div class="form-group">
                <label for="descricao">Descrição:</label>
                <input type="text" class="form-control" id="descricao" name="descricao">
                <label for="preco_declarado">Preço declarado:</label>
                <input type="money" class="form-control" id="preco_declarado" name="preco_declarado">
              </div>
              <div class="col-xs-6">
                <button class="btn btn-block btn-primary btn-default" id="btnsaveproduto">
                  <i class="fa fa-save"></i>&nbsp;Gravar
                </button>
              </div>
              <div class="col-xs-6">
                <button class="btn btn-block btn-danger" id="btndeleteproduto">
                  <i class="fa fa-trash"></i>&nbsp;Excluir
                </button>
              </div>
            </form>
          </div>
          <div class="col-xs-4" id="produtolist">
            <h3>Produtos cadastrados:</h3>
            <div class="form-group">
              <input type="text" class="form-control" id="txtfilterprodutos">
              <div class="col-xs-6">
                <button class="btn btn-default" id="btnfilterprodutos">
                  <i class="fa fa-filter"></i>Filtrar
                </button>
              </div>
              <div class="col-xs-6">
                <button class="btn btn-" id="btncleanfilterprodutos">
                  <i class="fa fa-eraser"></i>Limpar
                </button>
              </div>
            </div>
            <table class="table table-striped table-bordered table-hover table-responsive" cellspacing="0" cellpadding="0" id="produtos_table">
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="procedimentos" class="tab-pane fade">
        <div id="procedimentodetalhe" class="row">
          <div class="col-xs-8">
            <form id="frmprocedimento">
              <input type="hidden" id="idprocedimento" name="idprocedimento">
              <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" class="form-control" id="nome" name="nome">
              </div>
              <div class="col-xs-4">
                <button class="btn btn-block btn-primary btn-default" id="btnsaveprocedimento">
                  <i class="fa fa-save"></i>&nbsp;Gravar
                </button>
              </div>
              <div class="col-xs-4">
                <button class="btn btn-block btn-danger" id="btndeleteprocedimento">
                  <i class="fa fa-trash"></i>&nbsp;Excluir
                </button>
              </div>
              <div class="col-xs-4">
                <button class="btn btn-block btn-success" id="btndoprocedimento">
                  <i class="fa fa-cloud-download"></i>&nbsp;Executar
                </button>
              </div>
            </form>
            <div class="row">
              <hr> &nbsp;
              <br>
              <h3>Sites e produtos vinculados</h3>
              <hr>
              <div class="col-xs-6">
                <div class="ui-widget">
                  <input id="siteac" class="form-control" name="siteac" size="30%" placeholder="Entre título do site" />
                </div>
                <table class="table table-striped table-bordered table-responsive" cellspacing="0" cellpadding="0" id="siteac_table">
                  <tbody>
                  </tbody>
                </table>
              </div>
              <div class="col-xs-6">
                <div class="ui-widget">
                  <input id="produtoac" class="form-control" name="produtoac" size="30%" placeholder="Entre descricao do produto" />
                </div>
                <table class="table table-striped table-bordered table-responsive" cellspacing="0" cellpadding="0" id="produtoac_table">
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-xs-4" id="procedimentolist">
            <h3>Procedimentos cadastrados:</h3>
            <div class="form-group">
              <input type="text" class="form-control" id="txtfilterprocedimentos">
              <div class="col-xs-6">
                <button class="btn btn-default" id="btnfilterprocedimentos">
                  <i class="fa fa-filter"></i>Filtrar
                </button>
              </div>
              <div class="col-xs-6">
                <button class="btn btn-" id="btncleanfilterprocedimentos">
                  <i class="fa fa-eraser"></i>Limpar
                </button>
              </div>
            </div>
            <table class="table table-striped table-bordered table-hover table-responsive" cellspacing="0" cellpadding="0" id="procedimentos_table">
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="bottom" class="row">
        <div class="col-md-12">
          Copyleft IvanBrasilico 2017 - All stuff GPLv3 Licensed except explicited or from outer sources
        </div>
      </div>
    </div>
  </div>
  <!-- /#bottom -->
  <script src="/static/js/jquery.min.js"></script>
  <script src="/static/js/bootstrap.min.js"></script>
  <script src="/static/js/jquery-ui.min.js"></script>
  <script src="/static/js/jquery.maskMoney.min.js"></script>
  <script type="text/javascript">
    $("#frmsite").submit(function (event) {
      // Stop form from submitting normally
      event.preventDefault();
    });
    $("#frmproduto").submit(function (event) {
      event.preventDefault();
    });
    $("#frmprocedimento").submit(function (event) {
      event.preventDefault();
    });
    $(function () {
      $('[type=money]').maskMoney({
        thousands: '.',
        decimal: ','
      });
    })
    $(document).on('click', '#sites_table tbody tr', function () {
      id = $(this).find('td').eq(0).text();
      headers = {
        'Content-Type': 'application/json',
        'Authorization': 'JWT ' + $('#token').val()
      }
      url = '/api/sites/' + id
      $.ajax({
        dataType: 'json',
        url: url,
        headers: headers,
        type: 'get',
        success: function (data) {
          $("#id").val(data["id"]);
          $('#title').val(data["title"]);
          $('#url').val(data['url']);
          $('#targets tbody tr').remove();
          console.log(data["targets"]);
          $.each(data["targets"], function (index, target) {
            $('<tr>').append(
              $('<td>').text(index),
              $('<td>').text(JSON.stringify(target)),
              $('<td>').html('<input type="button" class="btn  btn-danger" value="x" onclick="deleteRow(this)" />')
            ).appendTo('#targets')
          });
        }
      });
    });
    $(document).on('click', '#produtos_table tbody tr', function () {
      id = $(this).find('td').eq(0).text();
      headers = {
        'Content-Type': 'application/json',
        'Authorization': 'JWT ' + $('#token').val()
      }
      url = '/api/produtos/' + id
      $.ajax({
        dataType: 'json',
        url: url,
        headers: headers,
        type: 'get',
        success: function (data) {
          $("#idproduto").val(data["id"]);
          $('#descricao').val(data["descricao"]);
          $('#preco_declarado').val(data["preco_declarado"]);
        }
      });
    });
    $(document).on('click', '#procedimentos_table tbody tr', function () {
      id = $(this).find('td').eq(0).text();
      headers = {
        'Content-Type': 'application/json',
        'Authorization': 'JWT ' + $('#token').val()
      }
      url = '/api/procedimentos/' + id
      $.ajax({
        dataType: 'json',
        url: url,
        headers: headers,
        type: 'get',
        success: function (data) {
          $("#idprocedimento").val(data["id"]);
          $('#nome').val(data["nome"]);
          $('#siteac_table tbody tr').remove();
          $.each(data["sites"], function (i, site) {
            $('<tr>').append(
              $('<td>').text(site.id),
              $('<td>').text(site.title),
              $('<td>').html('<input type="button" value="x" onclick="deleteRow(this)" />')
            ).appendTo('#siteac_table');
          });
          $('#produtoac_table tbody tr').remove();
          $.each(data["produtos"], function (i, produto) {
            $('<tr>').append(
              $('<td>').text(produto.id),
              $('<td>').text(produto.descricao),
              $('<td>').html('<input type="button" value="x" onclick="deleteRow(this)" />')
            ).appendTo('#produtoac_table');
          });
        }
      });
    });
    $(document).ready(function () {
      var token = $('#token').val();
      if (!token) {
        $('#login').load('/api/login_form');
      } else {
        load_tables();
      }
    });
    var load_tables = function () {
      list_filtered('sites', 'title');
      list_filtered('produtos', 'descricao');
      list_filtered('procedimentos', 'nome');
    }
    $(document).on('click', '#btntarget', function () {
      inclui_target();
    });
    $(document).on('click', '#btnfiltersites', function () {
      list_filtered('sites', 'title', $('#txtfiltersites').val());
    });
    $(document).on('click', '#btncleanfiltersites', function () {
      $('#txtfiltersites').val('')
      list_filtered('sites', 'title');
    });
    $(document).on('click', '#btnfilterprodutos', function () {
      list_filtered('produtos', 'descricao', $('#txtfilterprodutos').val());
    });
    $(document).on('click', '#btncleanfilterprodutos', function () {
      $('#txtfilterprodutos').val('')
      list_filtered('produtos', 'descricao');
    });
    $(document).on('click', '#btnfilterprocedimentos', function () {
      list_filtered('procedimentos', 'nome', $('#txtfilterprocedimentos').val());
    });
    $(document).on('click', '#btncleanfilterprocedimentos', function () {
      $('#txtfilterprocedimentos').val('')
      list_filtered('procedimentos', 'nome');
    });
    $(document).on('click', '#btnsave', function () {
      form = $('#frmsite');
      form_save(form, 'sites');
    });
    $(document).on('click', '#btnsaveproduto', function () {
      form = $('#frmproduto');
      form_save(form, 'produtos');
    });
    $(document).on('click', '#btnsaveprocedimento', function () {
      table_save();
      form = $('#frmprocedimento');
      form_save(form, 'procedimentos');
      $('#siteac_table tbody tr').remove();
      $('#produtoac_table tbody tr').remove();
    });
    $(document).on('click', '#btndelete', function () {
      form = $('#frmsite');
      one_id = $('#id').val();
      delete_form_id(form, 'sites', one_id, 'title');
      $('#txtfiltersites').val('')
    });
    $(document).on('click', '#btndeleteproduto', function () {
      form = $('#frmproduto');
      one_id = $('#idproduto').val();
      delete_form_id(form, 'produtos', one_id, 'descricao');
      $('#txtfilterprodutos').val('')
    });
    $(document).on('click', '#btndeleteprocedimento', function () {
      form = $('#frmprocedimento');
      one_id = $('#idprocedimento').val();
      delete_form_id(form, 'procedimentos', one_id, 'nome');
      $('#txtfilterprocedimentos').val('')
      $('#siteac_table tbody tr').remove();
      $('#produtoac_table tbody tr').remove();
    });
    $(document).on('click', '#btndoprocedimento', function () {
      window.open('/api/scrap?procedimento=' + $('#idprocedimento').val(), '_blank');
    });

    $("#siteac").autocomplete({
      source: function (request, response) {
        url = '/api/sites';
        params = '{"filters": [{ "name": "title", "op": "like", "val": "%' + request.term + '%"}]}'
        url = url + '?q=' + encodeURIComponent(params);
        headers = {
          'Content-Type': 'application/json',
          'Authorization': 'JWT ' + $('#token').val()
        }
        $.ajax({
          dataType: 'json',
          url: url,
          headers: headers,
          type: 'get',
          success: function (data) {
            var lista = [];
            $.each(data.objects, function (i, item) {
              lista.push({ "label": item.title, "id": item.id });
            });
            response(lista);
          }
        });
      },
      minLength: 2,
      select: function (event, ui) {
        $('<tr>').append(
          $('<td>').text(ui.item.id),
          $('<td>').text(ui.item.label),
          $('<td>').html('<input type="button" value="x" onclick="deleteRow(this)" />')
        ).appendTo('#siteac_table');
        $('#siteac').val('');
      }
    });
    $("#produtoac").autocomplete({
      source: function (request, response) {
        url = '/api/produtos';
        params = '{"filters": [{ "name": "descricao", "op": "like", "val": "%' + request.term + '%"}]}'
        url = url + '?q=' + encodeURIComponent(params);
        headers = {
          'Content-Type': 'application/json',
          'Authorization': 'JWT ' + $('#token').val()
        }
        $.ajax({
          dataType: 'json',
          url: url,
          headers: headers,
          type: 'get',
          success: function (data) {
            var lista = [];
            $.each(data.objects, function (i, item) {
              lista.push({ "label": item.descricao, "id": item.id });
            });
            response(lista);
          }
        });
      },
      minLength: 2,
      select: function (event, ui) {
        $('<tr>').append(
          $('<td>').text(ui.item.id),
          $('<td>').text(ui.item.label),
          $('<td>').html('<input type="button" value="x" onclick="deleteRow(this)" />')
        ).appendTo('#produtoac_table');
        $('#produtoac').val('');
      }
    });

    function deleteRow(atd) {
      var atr = atd.parentNode.parentNode;
      atr.parentNode.removeChild(atr);
    }

    var list_filtered = function (classe, campo, filter) {
      params = null;
      url = '/api/' + classe;
      if (filter) {
        params = '{"filters": [{ "name": "' + campo + '", "op": "like", "val": "%' + filter + '%"}]}'
        url = url + '?q=' + encodeURIComponent(params)
      }
      headers = {
        'Content-Type': 'application/json',
        'Authorization': 'JWT ' + $('#token').val()
      }
      $.ajax({
        dataType: 'json',
        url: url,
        headers: headers,
        type: 'get',
        success: function (data) {
          $('#' + classe + '_table tbody tr').remove();
          $.each(data.objects, function (i, item) {
            $('<tr>').append(
              $('<td>').text(item.id),
              $('<td>').text(item[campo])
            ).appendTo('#' + classe + '_table');
          });
        }
      });
    };
    var clear_form = function (form) {
      $.each(form[0].elements, function (index, formField) {
        if (formField.name) {
          $(formField).val('');
        }
      });
    };
    var delete_form_id = function (form, classe, one_id, campo) {
      url = '/api/' + classe;
      $.ajax({
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/vnd.api+json',
          'Authorization': 'JWT ' + $('#token').val()
        },
        url: url + '/' + one_id,
        type: 'delete',
        dataType: 'json',
        success: function (data) {
          clear_form(form);
          $('#success').empty().append("Site excluído.")
          $('#jsonsuccess').show();
          list_filtered(classe, campo);
        },
        error: function (data) {
          $('#erro').empty().append(data.responseJSON["message"])
          $('#jsonerror').show();
        }
      });
    }
    var form_save = function (form, classe) {
      url = '/api/' + classe;
      $('#jsonsuccess').hide();
      $('#jsonerror').hide();
      var formdata = {};
      var cont = 0;
      var primeiro_campo = '';
      var campo_id = '';
      $.each(form[0].elements, function (index, formField) {
        if (formField.name) {
          cont = cont + 1;
          if (cont == 1) { campo_id = formField.name; }
          else { formdata[formField.name] = $(formField).val(); }
          if (cont == 2) { primeiro_campo = formField.name }
        }
      });
      console.log(formdata);
      type = 'post';
      mensagem = classe + ' criado';
      save_url = url
      oid = $("#" + campo_id).val()
      if (oid) {
        type = 'put';
        mensagem = classe + ' atualizado';
        save_url = save_url + '/' + oid;
        $("#" + campo_id).val("");
      }
      $.ajax({
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/vnd.api+json',
          'Authorization': 'JWT ' + $('#token').val()
        },
        url: save_url,
        data: JSON.stringify(formdata),
        type: type,
        enctype: 'text/plain',
        dataType: 'json',
        success: function (data) {
          clear_form(form);
          $('#success').empty().append(mensagem + ".")
          $('#jsonsuccess').show();
          $('#txtfilter' + classe).val(data[primeiro_campo]);
          list_filtered(classe, primeiro_campo, data[primeiro_campo]);
        },
        error: function (data) {
          $('#erro').empty().append(data.responseJSON["message"])
          $('#jsonerror').show();
        }

      });
    }

    var table_save = function () {
      $('#jsonerror').hide();
      url = '/api/procedimentos';
      oid = $("#idprocedimento").val()
      url = '/api/procedimentos/' + id
      headers = {
        'Content-Type': 'application/json',
        'Accept': 'application/vnd.api+json',
        'Authorization': 'JWT ' + $('#token').val()
      }
      if (oid) {
        var datasites = [];
        var dataprodutos = [];
        var datasitesremove = [];
        var dataprodutosremove = [];
        $('#siteac_table tr td:first-child').each(function () {
          datasites.push({ "id": $(this).text() });
        });
        var dataprodutos = [];
        $('#produtoac_table tr td:first-child').each(function () {
          dataprodutos.push({ "id": $(this).text() });
        });
        $.ajax({
          dataType: 'json',
          url: url,
          headers: headers,
          type: 'get',
          success: function (data) {
            length = datasites.length;
            $.each(data["sites"], function (i, site) {
              removido = true;
              for (r = 0; r < length; r++) {
                console.log(datasites)
                console.log(datasites[r])
                if (datasites[r]['id'] == site.id) {
                  removido = false;
                  break;
                }
              }
              if (removido) {
                datasitesremove.push({ "id": site.id });
              }
            });
            length = dataprodutos.length;
            $.each(data["produtos"], function (i, produto) {
              removido = true;
              for (r = 0; r < length; r++) {
                if (dataprodutos[r]['id'] == produto.id) {
                  removido = false;
                  break;
                }
              }
              if (removido) {
                dataprodutosremove.push({ "id": produto.id });
              }
            });
          }
        });
        data = {
          'produtos': { 'add': dataprodutos },
          'sites': { 'add': datasites }
        }
        $.ajax({
          headers: headers,
          url: url,
          data: JSON.stringify(data),
          type: 'put',
          enctype: 'text/plain',
          dataType: 'json',
          success: function (data) {
          },
          error: function (data) {
            $('#erro').empty().append(data.responseJSON["message"])
            $('#jsonerror').show();
          }
        });
        data = {
          'produtos': { 'remove': dataprodutosremove },
          'sites': { 'remove': datasitesremove }
        }
        $.ajax({
          headers: headers,
          url: url,
          data: JSON.stringify(data),
          type: 'put',
          enctype: 'text/plain',
          dataType: 'json',
          success: function (data) {
          },
          error: function (data) {
            $('#erro').empty().append(data.responseJSON["message"])
            $('#jsonerror').show();
          }
        });
      }
    }
    var inclui_target = function () {
      if ($('#targetkey').val()) {
        $('<tr>').append(
          $('<td>').text($('#targetkey').val()),
          $('<td>').text($('#targetvalue').val()),
          $('<td>').html('<input type="button" value="x" onclick="deleteRow(this)" />')
        ).appendTo('#targets');
      }
      var targets = {};
      var table = document.getElementById('targets');
      var rowLength = table.rows.length;
      for (var i = 0; i < rowLength; i += 1) {
        var row = table.rows[i];
        list = row.cells[1].textContent.split(',');
        dict = {}
        list2 = list[1].split(':');
        if (list.length == 3) {
          if (list[1].indexOf('}') == -1) {
            dict[list2[0].substring(2, list2[0].length - 1)] = list2[1].substring(1, list2[1].length - 1);
            list3 = list[2].split(':');
            dict[list3[0].substring(1, list3[0].length - 1)] = list3[1].substring(1, list3[1].length - 3);
            array = [list[0].substring(2, list[0].length - 1), dict];
          } else {
            dict[list2[0].substring(2, list2[0].length - 1)] = list2[1].substring(1, list2[1].length - 2);
            array = [list[0].substring(2, list[0].length - 1), dict, list[2].substring(1, list[2].length - 2)];
          }
        } else {
          dict[list2[0].substring(2, list2[0].length - 1)] = list2[1].substring(1, list2[1].length - 3);
          array = [list[0].substring(2, list[0].length - 1), dict];
        }
        targets[row.cells[0].textContent] = array;
      }
      console.log(targets);
      data = { "targets": targets }
      console.log(data);
      $.ajax({
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/vnd.api+json',
          'Authorization': 'JWT ' + $('#token').val()
        },
        url: '/api/sites/' + $('#id').val(),
        data: JSON.stringify(data),
        type: 'put',
        enctype: 'text/plain',
        dataType: 'json',
        success: function (data) {
          $('#success').empty().append("OK")
          $('#jsonsuccess').show();
        },
        error: function (data) {
          $('#erro').empty().append(data.responseJSON["message"])
          $('#jsonerror').show();
        }
      });
    };
  </script>
</body>

</html>